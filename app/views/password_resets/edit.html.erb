<div class="mdl-layout mdl-js-layout">
  <main class="mdl-layout__content">
    <h3>My Wordlist</h3>
    <h4>Reset Your Password</h4>

    <%= form_with url: update_password_path, method: :patch do |form| %>
      <div class="field mdl-textfield mdl-js-textfield">
        <%= form.label :password, "New Password", class: "mdl-textfield__label" %>
        <%= form.password_field :password, minlength: 8, class: "mdl-textfield__input" %>
      </div>

      <div class="field mdl-textfield mdl-js-textfield">
        <%= form.label :password_confirmation, "Confirm New Password", class: "mdl-textfield__label" %>
        <%= form.password_field :password_confirmation, class: "mdl-textfield__input" %>
      </div>

      <%= hidden_field_tag :token, params[:token] %>

      <div class="actions">
        <%= form.submit "Reset Password", class: "mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" %>
      </div>
    <% end %>
  </main>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const password = document.getElementById("password");
    const passwordConfirmation = document.getElementById("password_confirmation");

    function validatePassword() {
      if (password.value !== passwordConfirmation.value) {
        passwordConfirmation.setCustomValidity("Passwords do not match.");
      } else {
        passwordConfirmation.setCustomValidity("");
      }
    }

    password.onchange = validatePassword;
    passwordConfirmation.onkeyup = validatePassword;

    const form = document.querySelector("form[data-remote='true']");
    if (form) {
      form.addEventListener("ajax:error", (event) => {
        event.preventDefault();
        const [data, status, xhr] = event.detail;
        console.log("Error response:", status, data);
        // Update the UI accordingly without reloading the page.
        // For example, show an error message to the user.
      });
    }
  });
</script>
